<?!=include_("myInterfaceStyles")?>
<div id="xeap">
<div id="wrapper">
<div class="boxed">
  <form class="gatewayform" onsubmit="checkAndSubmitPasswordChange(this)">
   <p><input type="password" name="pwd" placeholder="New Password" class="inputter"></p>
    <p><input type="password" name="pwdConf" placeholder="Reenter" class="inputter"></p>
    <p><input type="hidden" name="token" value="<?=token?>"></p>
    <p><input type="hidden" name="user" value="<?=user?>"></p>
    <p><input type="submit" value="Submit" id="sub"></p>
  </form>
  <img style='visibility:hidden;height:100px;width:100px' class='spinner' id='myspinner' src='http://s11.postimg.org/pvpn1xkun/ezgif_com_crop.gif'>

</div>
</div>
</div>
<script>
function checkAndSubmitPasswordChange(formElement) {
  document.getElementById('myspinner').style.visibility = "visible";
  var first = formElement.elements[0].value;
  var second = formElement.elements[1].value;
  if (first !== second) {
    alert("Your passwords do not match.");
    document.getElementById('myspinner').style.visibility = 'hidden';
    return;
  }
  //Next: make this actually do something other than checking passwords
  google.script.run.withSuccessHandler(complete).changePassword(formElement);
//  google.script.run.withSuccessHandler(success).sendAccountRequest(formElement);
//  document.getElementById("myspinner").style.visibility = "visible";
}
function complete() {
  document.open();
  document.write("Done! Please close this tab.");
}
</script>